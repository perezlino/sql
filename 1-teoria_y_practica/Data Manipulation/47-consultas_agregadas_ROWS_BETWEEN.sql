-- ======================================================
-- ========= CONSULTAS AGREGADAS - ROWS BETWEEN =========
-- ======================================================

-- =====================
-- === ROWS BETWEEN  ===
-- =====================

--  Lo que hace ROWS BETWEEN 

USE EJERCICIOS

--  Ejemplo 1
--  =========

SELECT * FROM tblAttendance

/*
|----------------|-----------------|------------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance |
|----------------|-----------------|------------------|
|      123	     |    2014-01-01   |	    14        |
|      123	     |    2014-02-01   |	    12        |
|      123	     |    2014-03-01   |	    23        |  
|      123       |    2014-04-01   | 	    21        |  
|      123       |    2014-05-01   |    	23        |  
|      123       |    2014-06-01   |	    14        |  
|      123       |    2014-07-01   |	    11        |  
|      123       |    2014-08-01   | 	    15        |  
|      123	     |    2014-09-01   | 	    14        |  
|      123	     |    2014-10-01   | 	    20        |  
|      123	     |    2014-11-01   | 	    24        |  
|      123	     |    2014-12-01   | 	    14        |  
|      123	     |    2015-01-01   | 	    21        |  
|      123	     |    2015-02-01   | 	    16        |  
|      123	     |    2015-03-01   | 	    17        |  
|      123	     |    2015-04-01   | 	    13        |  
|      123	     |    2015-05-01   | 	    11        |  
|      123	     |    2015-06-01   | 	    18        |  
|      123	     |    2015-07-01   | 	    24        |  
|      123	     |    2015-08-01   | 	    15        |  
|      123	     |    2015-09-01   | 	    19        |  
|      123	     |    2015-10-01   | 	    20        |  
|      124	     |    2014-01-01   | 	    17        |  
|      124	     |    2014-02-01   | 	    17        |  
|      124	     |    2014-03-01   | 	    24        |  
|      124	     |    2014-04-01   | 	    12        |  
|      124	     |    2014-05-01   | 	    20        |
|   .........    |   ............  |    ..........    |
|   .........    |   ............  |    ..........    |
|----------------|-----------------|------------------| */


-- Vemos que no podemos trabajarlo de manera individual sobre OVER() ni OVER(PARTITION BY). Necesariamente debe
-- existir ORDER BY.

SELECT *, SUM(NumberAttendance) OVER(ROWS BETWEEN 1 PRECEDING) AS RunningTotal
FROM tblAttendance
-- Msg 102, Level 15, State 1, Line 1
-- Incorrect syntax near 'ROWS'.

SELECT *, SUM(NumberAttendance) OVER(ROWS BETWEEN 1 FOLLOWING) AS RunningTotal
FROM tblAttendance
-- Msg 102, Level 15, State 1, Line 1
-- Incorrect syntax near 'ROWS'.

SELECT *, SUM(NumberAttendance) OVER(ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS RunningTotal
FROM tblAttendance
-- Msg 102, Level 15, State 1, Line 1
-- Incorrect syntax near 'ROWS'.

SELECT *, SUM(NumberAttendance) OVER(PARTITION BY EmployeeNumber ROWS BETWEEN 1 PRECEDING) RunningTotal
FROM tblAttendance
-- Msg 102, Level 15, State 1, Line 1
-- Incorrect syntax near ')'.

SELECT *, SUM(NumberAttendance) OVER(PARTITION BY EmployeeNumber ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) RunningTotal
FROM tblAttendance
-- Msg 10756, Level 15, State 1, Line 1
-- Window frame with ROWS or RANGE must have an ORDER BY clause.


/* ================================================================================================================== 

    Ejemplo 2 - Utilizando ORDER BY 
    ================================ 

    Se realizó un acumulado en la columna 'TotalAttendance' a partir del EmployeeNumber, donde desde el 
    EmployeeNumber '124' se comenzo a acumular el total. 
    Se sumó: 
    TotalAttendance EmployeeNumber = 123 ----> 379
    TotalAttendance EmployeeNumber = 124 ----> 427
                                            -----------
                                               806

*/
    SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber) TotalAttendance
    FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | TotalAttendance |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |      379        |
|      123	     |    2014-02-01   |	    12        |      379        |
|      123	     |    2014-03-01   |	    23        |      379        |  
|      123       |    2014-04-01   | 	    21        |      379        |   
|      123       |    2014-05-01   |    	23        |      379        |  
|      123       |    2014-06-01   |	    14        |      379        |  
|      123       |    2014-07-01   |	    11        |      379        |  
|      123       |    2014-08-01   | 	    15        |      379        |  
|      123	     |    2014-09-01   | 	    14        |      379        |  
|      123	     |    2014-10-01   | 	    20        |      379        |  
|      123	     |    2014-11-01   | 	    24        |      379        |  
|      123	     |    2014-12-01   | 	    14        |      379        |  
|      123	     |    2015-01-01   | 	    21        |      379        |  
|      123	     |    2015-02-01   | 	    16        |      379        |  
|      123	     |    2015-03-01   | 	    17        |      379        |  
|      123	     |    2015-04-01   | 	    13        |      379        |  
|      123	     |    2015-05-01   | 	    11        |      379        |  
|      123	     |    2015-06-01   | 	    18        |      379        |  
|      123	     |    2015-07-01   | 	    24        |      379        |  
|      123	     |    2015-08-01   | 	    15        |      379        |  
|      123	     |    2015-09-01   | 	    19        |      379        |  
|      123	     |    2015-10-01   | 	    20        |      379        |  
|      124	     |    2014-01-01   | 	    17        |      806        |  
|      124	     |    2014-02-01   | 	    17        |      806        |  
|      124	     |    2014-03-01   | 	    24        |      806        |  
|      124	     |    2014-04-01   | 	    12        |      806        |  
|      124	     |    2014-05-01   | 	    20        |      806        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|   

----------------------------------------------------------------------------------------------------------------------
SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN n PRECEDING AND n FOLLOWING) RunningTotal
FROM tblAttendance      */
----------------------------------------------------------------------------------------------------------------------

SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN 0 PRECEDING AND 0 FOLLOWING) RunningTotal
FROM tblAttendance

-- Seria lo mismo escribirlo de este modo:

SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN CURRENT ROW AND CURRENT ROW) RunningTotal
FROM tblAttendance

-- Retorna los mismos valores de NumberAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       14        |
|      123	     |    2014-02-01   |	    12        |       12        |  
|      123	     |    2014-03-01   |	    23        |       23        | 
|      123       |    2014-04-01   | 	    21        |       21        | 
|      123       |    2014-05-01   |    	23        |       23        |  
|      123       |    2014-06-01   |	    14        |       14        |  
|      123       |    2014-07-01   |	    11        |       11        |  
|      123       |    2014-08-01   | 	    15        |       15        |  
|      123	     |    2014-09-01   | 	    14        |       14        |  
|      123	     |    2014-10-01   | 	    20        |       20        |  
|      123	     |    2014-11-01   | 	    24        |       24        |  
|      123	     |    2014-12-01   | 	    14        |       14        |  
|      123	     |    2015-01-01   | 	    21        |       21        |  
|      123	     |    2015-02-01   | 	    16        |       16        |  
|      123	     |    2015-03-01   | 	    17        |       17        |  
|      123	     |    2015-04-01   | 	    13        |       13        |  
|      123	     |    2015-05-01   | 	    11        |       11        |  
|      123	     |    2015-06-01   | 	    18        |       18        |  
|      123	     |    2015-07-01   | 	    24        |       24        |  
|      123	     |    2015-08-01   | 	    15        |       15        |  
|      123	     |    2015-09-01   | 	    19        |       19        |  
|      123	     |    2015-10-01   | 	    20        |       20        |  
|      124	     |    2014-01-01   | 	    17        |       17        | 
|      124	     |    2014-02-01   | 	    17        |       17        | 
|      124	     |    2014-03-01   | 	    24        |       24        |  
|      124	     |    2014-04-01   | 	    12        |       12        |  
|      124	     |    2014-05-01   | 	    20        |       20        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|   */


SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN 1 PRECEDING AND 0 FOLLOWING) RunningTotal
FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       14        | -->  0 + 14 + 0 = 14
|      123	     |    2014-02-01   |	    12        |       26        | --> 14 + 12 + 0 = 26 
|      123	     |    2014-03-01   |	    23        |       35        | --> 12 + 23 + 0 = 35
|      123       |    2014-04-01   | 	    21        |       44        | --> 23 + 21 + 0 = 44
|      123       |    2014-05-01   |    	23        |       44        |  
|      123       |    2014-06-01   |	    14        |       37        |  
|      123       |    2014-07-01   |	    11        |       25        |  
|      123       |    2014-08-01   | 	    15        |       26        |  
|      123	     |    2014-09-01   | 	    14        |       29        |  
|      123	     |    2014-10-01   | 	    20        |       34        |  
|      123	     |    2014-11-01   | 	    24        |       44        |  
|      123	     |    2014-12-01   | 	    14        |       38        |  
|      123	     |    2015-01-01   | 	    21        |       35        |  
|      123	     |    2015-02-01   | 	    16        |       37        |  
|      123	     |    2015-03-01   | 	    17        |       33        |  
|      123	     |    2015-04-01   | 	    13        |       30        |  
|      123	     |    2015-05-01   | 	    11        |       24        |  
|      123	     |    2015-06-01   | 	    18        |       29        |  
|      123	     |    2015-07-01   | 	    24        |       42        |  
|      123	     |    2015-08-01   | 	    15        |       39        |  
|      123	     |    2015-09-01   | 	    19        |       34        |  
|      123	     |    2015-10-01   | 	    20        |       39        |  
|      124	     |    2014-01-01   | 	    17        |       37        | --> 20 + 17 +  0 = 37 
|      124	     |    2014-02-01   | 	    17        |       34        | --> 17 + 17 +  0 = 34 
|      124	     |    2014-03-01   | 	    24        |       41        |  
|      124	     |    2014-04-01   | 	    12        |       36        |  
|      124	     |    2014-05-01   | 	    20        |       32        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|   */


SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN 2 PRECEDING AND 0 FOLLOWING) RunningTotal
FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       14        | -->  0 + 14 +  0 = 14
|      123	     |    2014-02-01   |	    12        |       26        | --> 14 + 12 +  0 = 26 
|      123	     |    2014-03-01   |	    23        |       49        | --> 14 + 12 + 23 = 49
|      123       |    2014-04-01   | 	    21        |       56        | --> 12 + 23 + 21 = 56
|      123       |    2014-05-01   |    	23        |       67        |  
|      123       |    2014-06-01   |	    14        |       58        |  
|      123       |    2014-07-01   |	    11        |       48        |  
|      123       |    2014-08-01   | 	    15        |       40        |  
|      123	     |    2014-09-01   | 	    14        |       40        |  
|      123	     |    2014-10-01   | 	    20        |       49        |  
|      123	     |    2014-11-01   | 	    24        |       58        |  
|      123	     |    2014-12-01   | 	    14        |       58        |  
|      123	     |    2015-01-01   | 	    21        |       59        |  
|      123	     |    2015-02-01   | 	    16        |       51        |  
|      123	     |    2015-03-01   | 	    17        |       54        |  
|      123	     |    2015-04-01   | 	    13        |       46        |  
|      123	     |    2015-05-01   | 	    11        |       41        |  
|      123	     |    2015-06-01   | 	    18        |       42        |  
|      123	     |    2015-07-01   | 	    24        |       53        |  
|      123	     |    2015-08-01   | 	    15        |       57        |  
|      123	     |    2015-09-01   | 	    19        |       58        |  
|      123	     |    2015-10-01   | 	    20        |       54        |  
|      124	     |    2014-01-01   | 	    17        |       56        | --> 19 + 20 + 17 = 56 
|      124	     |    2014-02-01   | 	    17        |       54        | --> 20 + 17 + 17 = 54 
|      124	     |    2014-03-01   | 	    24        |       58        |  
|      124	     |    2014-04-01   | 	    12        |       53        |  
|      124	     |    2014-05-01   | 	    20        |       56        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|   */


SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN 9999 PRECEDING AND 0 FOLLOWING) RunningTotal
FROM tblAttendance

-- Seria lo mismo escribirlo de este modo:

SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN UNBOUNDED PRECEDING AND 0 FOLLOWING) RunningTotal
FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal    |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       14        |
|      123	     |    2014-02-01   |	    12        |       26        |
|      123	     |    2014-03-01   |	    23        |       49        |  
|      123       |    2014-04-01   | 	    21        |       70        |   
|      123       |    2014-05-01   |    	23        |       93        |  
|      123       |    2014-06-01   |	    14        |      107        |  
|      123       |    2014-07-01   |	    11        |      118        |  
|      123       |    2014-08-01   | 	    15        |      133        |  
|      123	     |    2014-09-01   | 	    14        |      147        |  
|      123	     |    2014-10-01   | 	    20        |      167        |  
|      123	     |    2014-11-01   | 	    24        |      191        |  
|      123	     |    2014-12-01   | 	    14        |      205        |  
|      123	     |    2015-01-01   | 	    21        |      226        |  
|      123	     |    2015-02-01   | 	    16        |      242        |  
|      123	     |    2015-03-01   | 	    17        |      259        |  
|      123	     |    2015-04-01   | 	    13        |      272        |  
|      123	     |    2015-05-01   | 	    11        |      283        |  
|      123	     |    2015-06-01   | 	    18        |      301        |  
|      123	     |    2015-07-01   | 	    24        |      325        |  
|      123	     |    2015-08-01   | 	    15        |      340        |  
|      123	     |    2015-09-01   | 	    19        |      359        |  
|      123	     |    2015-10-01   | 	    20        |      379        |  
|      124	     |    2014-01-01   | 	    17        |      396        |  
|      124	     |    2014-02-01   | 	    17        |      413        |  
|      124	     |    2014-03-01   | 	    24        |      437        |  
|      124	     |    2014-04-01   | 	    12        |      449        |  
|      124	     |    2014-05-01   | 	    20        |      469        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|    */


-- Aumentando FOLLOWING sería acumular sumando los valores posteriores.

SELECT *, SUM(NumberAttendance) OVER(ORDER BY EmployeeNumber ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) RunningTotal
FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal    |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       26        | -->  0 + 14 + 12 = 26
|      123	     |    2014-02-01   |	    12        |       49        | --> 14 + 12 + 23 = 49 
|      123	     |    2014-03-01   |	    23        |       56        | --> 12 + 23 + 21 = 56
|      123       |    2014-04-01   | 	    21        |       67        | --> 23 + 21 + 23 = 67
|      123       |    2014-05-01   |    	23        |       58        |  
|      123       |    2014-06-01   |	    14        |       48        |  
|      123       |    2014-07-01   |	    11        |       40        |  
|      123       |    2014-08-01   | 	    15        |       40        |  
|      123	     |    2014-09-01   | 	    14        |       49        |  
|      123	     |    2014-10-01   | 	    20        |       58        |  
|      123	     |    2014-11-01   | 	    24        |       58        |  
|      123	     |    2014-12-01   | 	    14        |       59        |  
|      123	     |    2015-01-01   | 	    21        |       51        |  
|      123	     |    2015-02-01   | 	    16        |       54        |  
|      123	     |    2015-03-01   | 	    17        |       46        |  
|      123	     |    2015-04-01   | 	    13        |       41        |  
|      123	     |    2015-05-01   | 	    11        |       42        |  
|      123	     |    2015-06-01   | 	    18        |       53        |  
|      123	     |    2015-07-01   | 	    24        |       57        |  
|      123	     |    2015-08-01   | 	    15        |       58        |  
|      123	     |    2015-09-01   | 	    19        |       54        |  
|      123	     |    2015-10-01   | 	    20        |       56        |  
|      124	     |    2014-01-01   | 	    17        |       54        | --> 20 + 17 + 17 = 54 
|      124	     |    2014-02-01   | 	    17        |       58        | --> 17 + 17 + 24 = 58 
|      124	     |    2014-03-01   | 	    24        |       53        |  
|      124	     |    2014-04-01   | 	    12        |       56        |  
|      124	     |    2014-05-01   | 	    20        |       59        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|   */


/* ================================================================================================================== 

    Ejemplo 3 - Utilizando PARTITION BY - ORDER BY 
    ============================================== 

    Vamos a utilizar dos campos en PARTITION BY. En este ejemplo, se particionara la informacion en la columna
    'RunningTotal' de acuerdo al campo EmployeeNumber y al Año del campo 'AttendanceMonth'. De acuerdo a estas 
    particiones se generará un acumulado.  */

    SELECT *, SUM(NumberAttendance) OVER(PARTITION BY EmployeeNumber, YEAR(AttendanceMonth) 
                                         ORDER BY AttendanceMonth) RunningTotal
    FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       14        |
|      123	     |    2014-02-01   |	    12        |       26        |
|      123	     |    2014-03-01   |	    23        |       49        |  
|      123       |    2014-04-01   | 	    21        |       70        |   
|      123       |    2014-05-01   |    	23        |       93        |  
|      123       |    2014-06-01   |	    14        |      107        |  
|      123       |    2014-07-01   |	    11        |      118        |  
|      123       |    2014-08-01   | 	    15        |      133        |  
|      123	     |    2014-09-01   | 	    14        |      147        |  
|      123	     |    2014-10-01   | 	    20        |      167        |  
|      123	     |    2014-11-01   | 	    24        |      191        |  
|      123	     |    2014-12-01   | 	    14        |      205        | <------------- 
|      123	     |    2015-01-01   | 	    21        |       21        |  
|      123	     |    2015-02-01   | 	    16        |       37        |  
|      123	     |    2015-03-01   | 	    17        |       54        |  
|      123	     |    2015-04-01   | 	    13        |       67        |  
|      123	     |    2015-05-01   | 	    11        |       78        |  
|      123	     |    2015-06-01   | 	    18        |       96        |  
|      123	     |    2015-07-01   | 	    24        |      120        |  
|      123	     |    2015-08-01   | 	    15        |      135        |  
|      123	     |    2015-09-01   | 	    19        |      154        |  
|      123	     |    2015-10-01   | 	    20        |      174        | <------------
|      124	     |    2014-01-01   | 	    17        |       17        |  
|      124	     |    2014-02-01   | 	    17        |       34        |  
|      124	     |    2014-03-01   | 	    24        |       58        |  
|      124	     |    2014-04-01   | 	    12        |       70        |  
|      124	     |    2014-05-01   | 	    20        |       90        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|  */


    SELECT *, SUM(NumberAttendance) OVER(PARTITION BY EmployeeNumber, YEAR(AttendanceMonth) 
                                         ORDER BY AttendanceMonth
                                         ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) RunningTotal
    FROM tblAttendance

/*
|----------------|-----------------|------------------|-----------------|
| EmployeeNumber | AttendanceMonth | NumberAttendance | RunningTotal |
|----------------|-----------------|------------------|-----------------|
|      123	     |    2014-01-01   |	    14        |       26        | -->  0 + 14 + 12 = 26
|      123	     |    2014-02-01   |	    12        |       49        | --> 14 + 12 + 23 = 49 
|      123	     |    2014-03-01   |	    23        |       56        | --> 12 + 23 + 21 = 56
|      123       |    2014-04-01   | 	    21        |       67        | --> 23 + 21 + 23 = 67
|      123       |    2014-05-01   |    	23        |       58        |  
|      123       |    2014-06-01   |	    14        |       48        |  
|      123       |    2014-07-01   |	    11        |       40        |  
|      123       |    2014-08-01   | 	    15        |       40        |  
|      123	     |    2014-09-01   | 	    14        |       49        |  
|      123	     |    2014-10-01   | 	    20        |       58        |  
|      123	     |    2014-11-01   | 	    24        |       58        |  
|      123	     |    2014-12-01   | 	    14        |       38        | --> 24 + 14 +  0 = 38
|      123	     |    2015-01-01   | 	    21        |       37        | -->  0 + 21 + 16 = 37
|      123	     |    2015-02-01   | 	    16        |       54        | --> 21 + 16 + 17 = 54 
|      123	     |    2015-03-01   | 	    17        |       46        |  
|      123	     |    2015-04-01   | 	    13        |       41        |  
|      123	     |    2015-05-01   | 	    11        |       42        |  
|      123	     |    2015-06-01   | 	    18        |       53        |  
|      123	     |    2015-07-01   | 	    24        |       57        |  
|      123	     |    2015-08-01   | 	    15        |       58        |  
|      123	     |    2015-09-01   | 	    19        |       54        |  
|      123	     |    2015-10-01   | 	    20        |       39        | --> 19 + 20 +  0 = 39 
|      124	     |    2014-01-01   | 	    17        |       34        | -->  0 + 17 + 17 = 34 
|      124	     |    2014-02-01   | 	    17        |       58        | --> 17 + 17 + 24 = 58 
|      124	     |    2014-03-01   | 	    24        |       53        |  
|      124	     |    2014-04-01   | 	    12        |       56        |  
|      124	     |    2014-05-01   | 	    20        |       59        |
|   .........    |   ............  |    ..........    |   ...........   |
|   .........    |   ............  |    ..........    |   ...........   |
|----------------|-----------------|------------------|-----------------|   */